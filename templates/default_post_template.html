<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link id="syntax-theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Meta Tags -->
    <title>{{ .Config.Blog.Name }} | {{ .Post.Frontmatter.Title }}</title>
    <meta name="description" content="{{ .Post.Frontmatter.Description }}">
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:url" content="{{ .Config.Blog.BaseUrl }}/{{ .Post.Frontmatter.Slug }}">
    <meta property="og:type" content="website">
    <meta property="og:title" content="{{ .Config.Blog.Name }} | {{ .Post.Frontmatter.Title }}">
    <meta property="og:description" content="{{ .Post.Frontmatter.Description }}">
    {{ if .Post.Frontmatter.ImageUrl }}
        <meta property="og:image" content="{{ .Post.Frontmatter.ImageUrl }}">
        <meta name="twitter:image" content="{{ .Post.Frontmatter.ImageUrl }}">
    {{ else }}
        <meta property="og:image" content="/tbicon.png">
        <meta name="twitter:image" content="/tbicon.png">
    {{ end }}
    
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ .Config.Blog.Name }} | {{ .Post.Frontmatter.Title }}">
    <meta name="twitter:description" content="{{ .Post.Frontmatter.Description }}">
    
    <!-- Favicon -->
    <link rel="icon" href="/tbicon.png" type="image/png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/style.css">
    
    <!-- Syntax Highlighting Script -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const body = document.body;
            const stylesheet = document.getElementById("syntax-theme");
            
            // Get stored theme from localStorage
            const currentTheme = localStorage.getItem("theme") || "default";
            
            // Function to set the syntax highlighting theme
            function setSyntaxTheme(theme) {
                if (theme === "secondary") {
                    stylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css";
                } else {
                    stylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css";
                }
            }
            
            // Apply stored theme
            if (currentTheme === "secondary") {
                body.classList.add("secondary-theme");
                setSyntaxTheme("secondary");
            } else {
                setSyntaxTheme("light");
            }
            
            // Highlight code blocks
            document.querySelectorAll("pre code").forEach((block) => {
                hljs.highlightElement(block);
            });
        });
    </script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EET2ZX4QY1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-EET2ZX4QY1');
    </script>
</head>
<body>
    {{ template "header.html" . }}
    
    <main class="container">
        <article class="blog-post">
            <h1>{{ .Post.Frontmatter.Title }}</h1>
            
            <div class="post-meta">
                Published on üìÖ <time datetime="{{ .Post.Frontmatter.Date }}">{{ .Post.Frontmatter.Date }}</time>
            </div>
            
            <div class="post-meta">
                Type: <a href="/{{ $.Config.Blog.PrefixURL }}{{ .Post.Frontmatter.Type }}">{{ .Post.Frontmatter.Type }}</a>
            </div>
            
            <div class="post-meta tags">
                <span class="post-series-label">üè∑Ô∏è Tags:</span>
                {{ range .Post.Frontmatter.Tags }}
                <a href="/{{ $.Config.Blog.PrefixURL }}tags/{{ . }}">#{{ . }}</a>
                {{ end }}
            </div>
            
            {{ if index .Post.Frontmatter.Extras "series" }}
            <div class="post-series">
                <span class="series-label">Part of the
                <span class="series-list">
                    {{ range index .Post.Frontmatter.Extras "series" }}
                    <a href="/{{ $.Config.Blog.PrefixURL }}series/{{ . }}" class="series-link">üìñ {{ . }}</a>
                    {{ end }}
                </span></span>
                <span class="series-label">series</span>
            </div>
            {{ end }}
            
            {{ if $.Config.AdminMode }}
            <div class="post-meta admin-controls">
                <button id="editor-edit">Edit</button>
                <button id="editor-delete" 
                        onclick="location.href='/{{.Config.Blog.PrefixURL}}editor/?slug={{ .Post.Frontmatter.Slug }}&method=delete'">
                    Delete
                </button>
            </div>
            {{ end }}
            
            <hr>
            
            <div class="post-content">
                {{ .Post.Content }}
            </div>
        </article>
    </main>
    
    <div id="comments">
        <script src="https://giscus.app/client.js"
            data-repo="Mr-Destructive/meetgor.com"
            data-repo-id="R_kgDOHZ6V_g"
            data-category="Q&A"
            data-category-id="DIC_kwDOHZ6V_s4CRfn4"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="dark_high_contrast"
            data-lang="en"
            crossorigin="anonymous"
            async>
        </script>
    </div>
    
    {{ template "footer.html" . }}
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editBtn = document.getElementById('editor-edit');
            
            if (editBtn) {
                editBtn.addEventListener('click', async function () {
                    const slug = "{{ .Post.Frontmatter.Slug }}";
                    const type = "{{ .Post.Frontmatter.Type }}";
                    console.log("Editing post:", slug, type);
                    const url = "{{ .Config.Blog.CloudFunction.base_url }}/.netlify/functions/api?slug=" + slug + "&method=edit&type=" + type;
                    
                    try {
                        const res = await fetch(url);
                        
                        if (!res.ok) throw new Error("Failed to fetch edit content");
                        console.log(res);
                        
                        const html = await res.text();
                        console.log(html);
                        
                        document.querySelector('.post-content').innerHTML = html;
                    } catch (err) {
                        console.error(err);
                        alert("Error loading editor content");
                    }
                });
            }
        });
    </script>
    <script>
        // Theme toggle functionality
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggle = document.getElementById('theme-toggle');
            const body = document.body;
            
            if (!themeToggle) return;
            
            // Check for saved theme or default to light mode
            const currentTheme = localStorage.getItem('theme') || 'default';
            
            // Apply saved theme
            if (currentTheme === 'secondary') {
                body.classList.add('secondary-theme');
                themeToggle.checked = true;
            }
            
            // Listen for theme toggle changes
            themeToggle.addEventListener('change', () => {
                if (themeToggle.checked) {
                    body.classList.add('secondary-theme');
                    localStorage.setItem('theme', 'secondary');
                } else {
                    body.classList.remove('secondary-theme');
                    localStorage.setItem('theme', 'default');
                }
            });
        });
    </script>
</body>
</html>