<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>Django Bulk Update QuerySet objects | Meet Gor</title>
    <meta name="title" content="Django Bulk Update QuerySet objects | Meet Gor">
    <meta name="description" content="Using bulk_update to update multiple objects in one go.">
    <meta name="author" content="Meet Gor">
    <meta name="keywords" content="django, python">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="meetgor.com/til/django-bulk-update-queryset">
    
    
    <meta property="og:type" content="article">
    <meta property="og:url" content="meetgor.com/til/django-bulk-update-queryset">
    <meta property="og:title" content="Django Bulk Update QuerySet objects | Meet Gor">
    <meta property="og:description" content="Using bulk_update to update multiple objects in one go.">
    <meta property="og:image" content="meetgor.com/tbicon.png">
    <meta property="og:site_name" content="Meet Gor">
    <meta property="article:published_time" content="2022-10-31">
    <meta property="article:modified_time" content="2022-10-31">
    <meta property="article:author" content="Meet Gor">
    
    <meta property="article:tag" content="django">
    
    <meta property="article:tag" content="python">
    
    
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@meetgor711">
    <meta name="twitter:creator" content="@meetgor711">
    <meta name="twitter:url" content="meetgor.com/til/django-bulk-update-queryset">
    <meta name="twitter:title" content="Django Bulk Update QuerySet objects | Meet Gor">
    <meta name="twitter:description" content="Using bulk_update to update multiple objects in one go.">
    <meta name="twitter:image" content="meetgor.com/tbicon.png">
    
    
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "meetgor.com/til\/django-bulk-update-queryset"
        },
        "headline": "Django Bulk Update QuerySet objects",
        "description": "Using bulk_update to update multiple objects in one go.",
        "datePublished": "2022-10-31",
        "dateModified": "2022-10-31",
        "author": {
            "@type": "Person",
            "name": "Meet Gor"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Meet Gor",
            "logo": {
                "@type": "ImageObject",
                "url": "meetgor.com/tbicon.png"
            }
        },
        
        "keywords": "django, python",
        "articleBody": "\u0026lt;p\u0026gt;Let\u0026#39;s say, I have a lots of objects which I want to update with a particular field or fields. We can use the \u0026lt;a href=\u0026#34;https:\/\/docs.djangoproject.com\/en\/4.1\/ref\/models\/querysets\/#bulk-update\u0026#34;\u0026gt;bulk_update\u0026lt;\/a\u0026gt; method with the model name.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;code-block\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;code-header\u0026#34;\u0026gt;\u0026lt;span class=\u0026#34;language-name\u0026#34;\u0026gt;python\u0026lt;\/span\u0026gt;\u0026lt;button class=\u0026#34;copy-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-copy\u0026#34;\u0026gt;\u0026lt;rect x=\u0026#34;9\u0026#34; y=\u0026#34;9\u0026#34; width=\u0026#34;13\u0026#34; height=\u0026#34;13\u0026#34; rx=\u0026#34;2\u0026#34; ry=\u0026#34;2\u0026#34;\u0026gt;\u0026lt;\/rect\u0026gt;\u0026lt;path d=\u0026#34;M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-python\u0026#34;\u0026gt;# blog\/models.py\n\nfrom django.db import models\n\nARTICLE_STATUS = [\n    (\u0026#34;PUBLISHED\u0026#34;, \u0026#34;Published\u0026#34;),\n    (\u0026#34;DRAFT\u0026#34;, \u0026#34;Draft\u0026#34;),\n]\n\nclass Article(models.Model):\n    title = models.CharField(max_length=128)\n    description = models.CharField(max_length=512)\n    content = models.TextField()\n    status = models.CharField(max_length=16, choices=ARTICLE_STATUS, default=\u0026#34;DRAFT\u0026#34;)\n\n    def __str__(self):\n        return self.title\n\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;Let\u0026#39;s say we have a simple model \u0026lt;code\u0026gt;Article\u0026lt;\/code\u0026gt; with a few typical attributes like \u0026lt;code\u0026gt;title\u0026lt;\/code\u0026gt;, \u0026lt;code\u0026gt;description\u0026lt;\/code\u0026gt;, \u0026lt;code\u0026gt;content\u0026lt;\/code\u0026gt;, and \u0026lt;code\u0026gt;status\u0026lt;\/code\u0026gt;. We have the status as a choice field from two options as \u0026lt;code\u0026gt;Draft\u0026lt;\/code\u0026gt; and \u0026lt;code\u0026gt;Published\u0026lt;\/code\u0026gt;. It could be a boolean field, but that looks too gross for a article status.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;code-block\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;code-header\u0026#34;\u0026gt;\u0026lt;span class=\u0026#34;language-name\u0026#34;\u0026gt;python\u0026lt;\/span\u0026gt;\u0026lt;button class=\u0026#34;copy-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-copy\u0026#34;\u0026gt;\u0026lt;rect x=\u0026#34;9\u0026#34; y=\u0026#34;9\u0026#34; width=\u0026#34;13\u0026#34; height=\u0026#34;13\u0026#34; rx=\u0026#34;2\u0026#34; ry=\u0026#34;2\u0026#34;\u0026gt;\u0026lt;\/rect\u0026gt;\u0026lt;path d=\u0026#34;M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-python\u0026#34;\u0026gt;\nfrom blog.models import Article\n\narticles = Article.objects.filter(status=\u0026#34;draft\u0026#34;)\n\nfor i in range(len(articles)):\n    articles[i].status = \u0026#34;published\u0026#34;\n\nArticle.objects.bulk_update(articles, [\u0026#34;status\u0026#34;,])\n\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;In the above code, the \u0026lt;code\u0026gt;Articles\u0026lt;\/code\u0026gt; model is filtered by the status of \u0026lt;code\u0026gt;draft\u0026lt;\/code\u0026gt;. We iterate over the \u0026lt;code\u0026gt;QuerySet\u0026lt;\/code\u0026gt; which will contain the objects of the articles, by setting the object\u0026#39;s properties to the value we want to set. We are jsut setting the value of the property of the object for each object.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;This just makes a changes to the \u0026lt;code\u0026gt;QuerySet\u0026lt;\/code\u0026gt;, by using the \u0026lt;code\u0026gt;bulk_update\u0026lt;\/code\u0026gt; method, the two parameters required are the \u0026lt;code\u0026gt;QuerySet\u0026lt;\/code\u0026gt; and the list of \u0026lt;code\u0026gt;fields\u0026lt;\/code\u0026gt; which are to be updated. The function returns the number of objects\/records updated.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;code-block\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;code-header\u0026#34;\u0026gt;\u0026lt;span class=\u0026#34;language-name\u0026#34;\u0026gt;python\u0026lt;\/span\u0026gt;\u0026lt;button class=\u0026#34;copy-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-copy\u0026#34;\u0026gt;\u0026lt;rect x=\u0026#34;9\u0026#34; y=\u0026#34;9\u0026#34; width=\u0026#34;13\u0026#34; height=\u0026#34;13\u0026#34; rx=\u0026#34;2\u0026#34; ry=\u0026#34;2\u0026#34;\u0026gt;\u0026lt;\/rect\u0026gt;\u0026lt;path d=\u0026#34;M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-python\u0026#34;\u0026gt;\u0026gt;\u0026gt;\u0026gt; from blog.models import Article\n\u0026gt;\u0026gt;\u0026gt; articles = Article.objects.filter(status=\u0026#34;DRAFT\u0026#34;)\n\u0026gt;\u0026gt;\u0026gt; articles\n\u0026lt;QuerySet [\u0026lt;Article: test 1\u0026gt;, \u0026lt;Article: test 3\u0026gt;]\u0026gt;\n\n\u0026gt;\u0026gt;\u0026gt; for i in range(len(articles)):\n...     articles[i].status = \u0026#34;PUBLISHED\u0026#34;\n...\n\u0026gt;\u0026gt;\u0026gt; articles\n\u0026lt;QuerySet [\u0026lt;Article: test 1\u0026gt;, \u0026lt;Article: test 3\u0026gt;]\u0026gt;\n\u0026gt;\u0026gt;\u0026gt;\n\n\u0026gt;\u0026gt;\u0026gt; Article.objects.bulk_update(articles, [\u0026#39;status\u0026#39;,])\n2\n\n\u0026gt;\u0026gt;\u0026gt; Article.obejcts.get(title=\u0026#34;test 1\u0026#34;).status\n\u0026#39;PUBLISHED\u0026#39;\n\n\u0026gt;\u0026gt;\u0026gt; Article.objects.filter(status=\u0026#34;DRAFT\u0026#34;)\n\u0026lt;QuerySet []\u0026gt;\n\u0026gt;\u0026gt;\u0026gt;\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;As, we can see here there were two obejcts \u0026lt;code\u0026gt;test 1\u0026lt;\/code\u0026gt; and \u0026lt;code\u0026gt;test 2\u0026lt;\/code\u0026gt; objects with the status as \u0026lt;code\u0026gt;Draft\u0026lt;\/code\u0026gt;. By iterating over the queryset and assigning the status of the object to published, the query set was changed and modified locally.\nBy using the \u0026lt;code\u0026gt;bulk_update\u0026lt;\/code\u0026gt; method, we parsed the queryset and the list of attributes to be updated into the function. This gives us the number of objects which were updated, in this case \u0026lt;code\u0026gt;2\u0026lt;\/code\u0026gt;. We then look into the article actual record in the database and it has indeed updated to the value we set in this operation.\u0026lt;\/p\u0026gt;\n"
    }
    </script>
    
    
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/code-block.css">
    
    <link rel="icon" href="/tbicon.png" type="image/png">
    <link rel="apple-touch-icon" href="/tbicon.png">
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link id="syntax-theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.13.0/sql-wasm.js"></script>
    <link rel="stylesheet" href="/sql-playground.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/sql/sql.min.js"></script>
    <script src="/sql-playground.js"></script>
    
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const body = document.body;
        const stylesheet = document.getElementById("syntax-theme");
        const themeToggle = document.getElementById('theme-toggle');

        function setSyntaxTheme(theme) {
            if (theme === "secondary") {
                stylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css";
            } else {
                stylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css";
            }
        }

        
        document.querySelectorAll("pre code").forEach((block) => {
            hljs.highlightElement(block);
        });

        
        const currentTheme = localStorage.getItem("theme") || "default";
        if (currentTheme === "secondary") {
            body.classList.add("secondary-theme");
            if (themeToggle) themeToggle.checked = true;
        }
        setSyntaxTheme(currentTheme);

        
        if (themeToggle) {
            themeToggle.addEventListener('change', () => {
                const newTheme = themeToggle.checked ? 'secondary' : 'default';
                if (themeToggle.checked) {
                    body.classList.add('secondary-theme');
                } else {
                    body.classList.remove('secondary-theme');
                }
                localStorage.setItem('theme', newTheme);
                setSyntaxTheme(newTheme);
            });
        }
        
        
        const editBtn = document.getElementById('editor-edit');
        if (editBtn) {
            editBtn.addEventListener('click', async function () {
                const slug = "til\/django-bulk-update-queryset";
                const type = "til";
                console.log("Editing post:", slug, type);
                const url = "https:\/\/devmeetgor.netlify.app/.netlify/functions/api?slug=" + slug + "&method=edit&type=" + type;
                
                try {
                    const res = await fetch(url);
                    if (!res.ok) throw new Error("Failed to fetch edit content");
                    const html = await res.text();
                    document.querySelector('.post-content').innerHTML = html;
                } catch (err) {
                    console.error(err);
                    alert("Error loading editor content");
                }
            });
        }
    });
    </script>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EET2ZX4QY1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-EET2ZX4QY1');
    </script>
</head>
<body>
    <header class="header">
  <a class="site-title" href="/" aria-label="Meet Gor - Home">Meet Gor</a>
  <nav>
    <ul>
      <li><a href="/" aria-label="Home">Home</a></li>
      <li><a href="/posts" aria-label="Posts">Posts</a></li>
      <li><a href="/about" aria-label="About">About</a></li>
      <li><a href="/contact" aria-label="Contact">Contact</a></li>
    </ul>
  </nav>
  <div class="theme-switch">
    <input type="checkbox" id="theme-toggle" aria-label="Toggle Theme">
    <label for="theme-toggle"></label>
  </div>
  
</header>
    
    <main class="container">
        <article class="blog-post">
            <h1>Django Bulk Update QuerySet objects</h1>
            
            <div class="post-meta">
                Published on 📅 <time datetime="2022-10-31">2022-10-31</time>
            </div>
            
            <div class="post-meta">
                Type: <a href="/til">til</a>
            </div>
            
            <div class="post-meta tags">
                <span class="post-series-label">🏷️ Tags:</span>
                
                <a href="/tags/django">#django</a>
                
                <a href="/tags/python">#python</a>
                
            </div>
            
            
            
            
            
            <hr>
            
            <div class="post-content">
                <p>Let's say, I have a lots of objects which I want to update with a particular field or fields. We can use the <a href="https://docs.djangoproject.com/en/4.1/ref/models/querysets/#bulk-update">bulk_update</a> method with the model name.</p>
<div class="code-block"><div class="code-header"><span class="language-name">python</span><button class="copy-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><pre><code class="language-python"># blog/models.py

from django.db import models

ARTICLE_STATUS = [
    ("PUBLISHED", "Published"),
    ("DRAFT", "Draft"),
]

class Article(models.Model):
    title = models.CharField(max_length=128)
    description = models.CharField(max_length=512)
    content = models.TextField()
    status = models.CharField(max_length=16, choices=ARTICLE_STATUS, default="DRAFT")

    def __str__(self):
        return self.title

</code></pre></div><p>Let's say we have a simple model <code>Article</code> with a few typical attributes like <code>title</code>, <code>description</code>, <code>content</code>, and <code>status</code>. We have the status as a choice field from two options as <code>Draft</code> and <code>Published</code>. It could be a boolean field, but that looks too gross for a article status.</p>
<div class="code-block"><div class="code-header"><span class="language-name">python</span><button class="copy-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><pre><code class="language-python">
from blog.models import Article

articles = Article.objects.filter(status="draft")

for i in range(len(articles)):
    articles[i].status = "published"

Article.objects.bulk_update(articles, ["status",])

</code></pre></div><p>In the above code, the <code>Articles</code> model is filtered by the status of <code>draft</code>. We iterate over the <code>QuerySet</code> which will contain the objects of the articles, by setting the object's properties to the value we want to set. We are jsut setting the value of the property of the object for each object.</p>
<p>This just makes a changes to the <code>QuerySet</code>, by using the <code>bulk_update</code> method, the two parameters required are the <code>QuerySet</code> and the list of <code>fields</code> which are to be updated. The function returns the number of objects/records updated.</p>
<div class="code-block"><div class="code-header"><span class="language-name">python</span><button class="copy-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><pre><code class="language-python">>>> from blog.models import Article
>>> articles = Article.objects.filter(status="DRAFT")
>>> articles
<QuerySet [<Article: test 1>, <Article: test 3>]>

>>> for i in range(len(articles)):
...     articles[i].status = "PUBLISHED"
...
>>> articles
<QuerySet [<Article: test 1>, <Article: test 3>]>
>>>

>>> Article.objects.bulk_update(articles, ['status',])
2

>>> Article.obejcts.get(title="test 1").status
'PUBLISHED'

>>> Article.objects.filter(status="DRAFT")
<QuerySet []>
>>>
</code></pre></div><p>As, we can see here there were two obejcts <code>test 1</code> and <code>test 2</code> objects with the status as <code>Draft</code>. By iterating over the queryset and assigning the status of the object to published, the query set was changed and modified locally.
By using the <code>bulk_update</code> method, we parsed the queryset and the list of attributes to be updated into the function. This gives us the number of objects which were updated, in this case <code>2</code>. We then look into the article actual record in the database and it has indeed updated to the value we set in this operation.</p>

            </div>
        </article>
    </main>
    
    <div id="comments">
        <script src="https://giscus.app/client.js"
            data-repo="Mr-Destructive/meetgor.com"
            data-repo-id="R_kgDOHZ6V_g"
            data-category="Q&A"
            data-category-id="DIC_kwDOHZ6V_s4CRfn4"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="dark_high_contrast"
            data-lang="en"
            crossorigin="anonymous"
            async>
        </script>
    </div>
    
    <footer class="site-footer" role="contentinfo">
  <div class="footer-content">
    <p>&copy; Meet Gor. All rights reserved.</p>
    <div class="social-links">
      <a href="/contact" aria-label="Connect with me">Connect with me</a>
    </div>
  </div>
</footer>
    
</body>
</html>
