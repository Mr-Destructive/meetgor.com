<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>Advent of SQL 2025 Day 11: Behavior Score | Meet Gor</title>
    <meta name="title" content="Advent of SQL 2025 Day 11: Behavior Score | Meet Gor">
    <meta name="description" content="">
    <meta name="author" content="Meet Gor">
    <meta name="keywords" content="sqlite, sql, advent-of-sql">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://meetgor.com/sqlog/advent-of-sql-2025-day-11">
    
    
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://meetgor.com/sqlog/advent-of-sql-2025-day-11">
    <meta property="og:title" content="Advent of SQL 2025 Day 11: Behavior Score">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://meetgor.com/tbicon.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Advent of SQL 2025 Day 11: Behavior Score">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Meet Gor">
    <meta property="article:published_time" content="2025-12-26 15:30 &#43;0530">
    <meta property="article:modified_time" content="2025-12-26 15:30 &#43;0530">
    <meta property="article:author" content="Meet Gor">
    
    <meta property="article:tag" content="sqlite">
    
    <meta property="article:tag" content="sql">
    
    <meta property="article:tag" content="advent-of-sql">
    
    
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@meetgor711">
    <meta name="twitter:creator" content="@meetgor711">
    <meta name="twitter:url" content="https://meetgor.com/sqlog/advent-of-sql-2025-day-11">
    <meta name="twitter:title" content="Advent of SQL 2025 Day 11: Behavior Score">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://meetgor.com/tbicon.png">
    <meta name="twitter:image:alt" content="Advent of SQL 2025 Day 11: Behavior Score">
    
    
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/meetgor.com/sqlog\/advent-of-sql-2025-day-11"
        },
        "headline": "Advent of SQL 2025 Day 11: Behavior Score",
        "description": "",
        "datePublished": "2025-12-26 15:30 \u002b0530",
        "dateModified": "2025-12-26 15:30 \u002b0530",
        "author": {
            "@type": "Person",
            "name": "Meet Gor"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Meet Gor",
            "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/meetgor.com/tbicon.png"
            }
        },
        
        "keywords": "sqlite, sql, advent-of-sql",
        "articleBody": "\u0026lt;h2 id=\u0026#34;advent-of-sql---day-11-behavior-score\u0026#34;\u0026gt;Advent of SQL - Day 11, Behavior Score\u0026lt;\/h2\u0026gt;\n\u0026lt;p\u0026gt;All right, this is day 11 from Advent of SQL.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;Let\u0026#39;s pull in the data.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt;DROP TABLE IF EXISTS behavior_logs;\n\nCREATE TABLE behavior_logs (\n    id INT PRIMARY KEY,\n    child_id INT,\n    child_name TEXT,\n    behavior_date DATE,\n    score INT\n);\n\nINSERT INTO behavior_logs (id, child_id, child_name, behavior_date, score) VALUES\n    (1, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-01\u0026#39;, 5),\n    (2, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-02\u0026#39;, 1),\n    (3, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-03\u0026#39;, 3),\n    (4, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-04\u0026#39;, 5),\n    (5, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-05\u0026#39;, 2),\n    (6, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-06\u0026#39;, 2),\n    (7, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-07\u0026#39;, 3),\n    (8, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-08\u0026#39;, 5),\n    (9, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-09\u0026#39;, 4),\n    (10, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-10\u0026#39;, 5),\n    (11, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-11\u0026#39;, 5),\n    (12, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-12\u0026#39;, -1),\n    (13, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-13\u0026#39;, 1),\n    (14, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-14\u0026#39;, 1),\n    (15, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-15\u0026#39;, -1),\n    (16, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-16\u0026#39;, 3),\n    (17, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-17\u0026#39;, -2),\n    (18, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-18\u0026#39;, 1),\n    (19, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-19\u0026#39;, 1),\n    (20, 1, \u0026#39;Emma D.\u0026#39;, \u0026#39;2025-12-20\u0026#39;, -2),\n    (21, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-01\u0026#39;, 0),\n    (22, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-02\u0026#39;, -1),\n    (23, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-03\u0026#39;, 4),\n    (24, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-04\u0026#39;, 0),\n    (25, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-05\u0026#39;, 2),\n    (26, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-06\u0026#39;, 3),\n    (27, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-07\u0026#39;, 5),\n    (28, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-08\u0026#39;, 2),\n    (29, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-09\u0026#39;, 1),\n    (30, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-10\u0026#39;, 5),\n    (31, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-11\u0026#39;, 2),\n    (32, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-12\u0026#39;, 5),\n    (33, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-13\u0026#39;, 5),\n    (34, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-14\u0026#39;, 2),\n    (35, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-15\u0026#39;, 0),\n    (36, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-16\u0026#39;, 0),\n    (37, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-17\u0026#39;, 5),\n    (38, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-18\u0026#39;, 4),\n    (39, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-19\u0026#39;, 5),\n    (40, 2, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-20\u0026#39;, 5),\n    (181, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-01\u0026#39;, 3),\n    (182, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-02\u0026#39;, 0),\n    (183, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-03\u0026#39;, 3),\n    (184, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-04\u0026#39;, 5),\n    (185, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-05\u0026#39;, 5),\n    (186, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-06\u0026#39;, 4),\n    (187, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-07\u0026#39;, 1),\n    (188, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-08\u0026#39;, 4),\n    (189, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-09\u0026#39;, 5),\n    (190, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-10\u0026#39;, 5),\n    (191, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-11\u0026#39;, 5),\n    (192, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-12\u0026#39;, 0),\n    (193, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-13\u0026#39;, 0),\n    (194, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-14\u0026#39;, 3),\n    (195, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-15\u0026#39;, 1),\n    (196, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-16\u0026#39;, 3),\n    (197, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-17\u0026#39;, -1),\n    (198, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-18\u0026#39;, 0),\n    (199, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-19\u0026#39;, 5),\n    (200, 10, \u0026#39;Ava C.\u0026#39;, \u0026#39;2025-12-20\u0026#39;, 4),\n    (241, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-01\u0026#39;, 3),\n    (242, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-02\u0026#39;, 2),\n    (243, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-03\u0026#39;, 2),\n    (244, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-04\u0026#39;, 1),\n    (245, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-05\u0026#39;, -1),\n    (246, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-06\u0026#39;, -1),\n    (247, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-07\u0026#39;, 2),\n    (248, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-08\u0026#39;, 5),\n    (249, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-09\u0026#39;, 0),\n    (250, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-10\u0026#39;, 5),\n    (251, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-11\u0026#39;, 2),\n    (252, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-12\u0026#39;, -1),\n    (253, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-13\u0026#39;, 2),\n    (254, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-14\u0026#39;, 3),\n    (255, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-15\u0026#39;, 2),\n    (256, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-16\u0026#39;, -1),\n    (257, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-17\u0026#39;, -2),\n    (258, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-18\u0026#39;, -4),\n    (259, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-19\u0026#39;, -3),\n    (260, 13, \u0026#39;Ava R.\u0026#39;, \u0026#39;2025-12-20\u0026#39;, 2),\n    (1961, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-01\u0026#39;, 2),\n    (1962, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-02\u0026#39;, -2),\n    (1963, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-03\u0026#39;, -1),\n    (1964, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-04\u0026#39;, -2),\n    (1965, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-05\u0026#39;, 3),\n    (1966, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-06\u0026#39;, -1),\n    (1967, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-07\u0026#39;, 0),\n    (1968, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-08\u0026#39;, 1),\n    (1969, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-09\u0026#39;, 0),\n    (1970, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-10\u0026#39;, 0),\n    (1971, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-11\u0026#39;, 3),\n    (1972, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-12\u0026#39;, 4),\n    (1973, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-13\u0026#39;, 4),\n    (1974, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-14\u0026#39;, 0),\n    (1975, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-15\u0026#39;, 3),\n    (1976, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-16\u0026#39;, -1),\n    (1977, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-17\u0026#39;, -1),\n    (1978, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-18\u0026#39;, 3),\n    (1979, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-19\u0026#39;, 3),\n    (1980, 99, \u0026#39;Ava X.\u0026#39;, \u0026#39;2025-12-20\u0026#39;, -3);\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;No hiccups! Good to go.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;We just have one table today.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt; SELECT * FROM behavior_logs;\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;div class=\u0026#34;code-block\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;code-header\u0026#34;\u0026gt;\u0026lt;span class=\u0026#34;language-name\u0026#34;\u0026gt;\u0026lt;\/span\u0026gt;\u0026lt;button class=\u0026#34;copy-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-copy\u0026#34;\u0026gt;\u0026lt;rect x=\u0026#34;9\u0026#34; y=\u0026#34;9\u0026#34; width=\u0026#34;13\u0026#34; height=\u0026#34;13\u0026#34; rx=\u0026#34;2\u0026#34; ry=\u0026#34;2\u0026#34;\u0026gt;\u0026lt;\/rect\u0026gt;\u0026lt;path d=\u0026#34;M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;sqlite\u0026gt; .read day11-inserts.sql\nsqlite\u0026gt; .mode table\nsqlite\u0026gt; .schema\nCREATE TABLE behavior_logs (\n    id INT PRIMARY KEY,\n    child_id INT,\n    child_name TEXT,\n    behavior_date DATE,\n    score INT\n);\nsqlite\u0026gt; SELECT * FROM behavior_logs LIMIT 20;\n\u002b----\u002b----------\u002b------------\u002b---------------\u002b-------\u002b\n| id | child_id | child_name | behavior_date | score |\n\u002b----\u002b----------\u002b------------\u002b---------------\u002b-------\u002b\n| 1  | 1        | Emma D.    | 2025-12-01    | 5     |\n| 2  | 1        | Emma D.    | 2025-12-02    | 1     |\n| 3  | 1        | Emma D.    | 2025-12-03    | 3     |\n| 4  | 1        | Emma D.    | 2025-12-04    | 5     |\n| 5  | 1        | Emma D.    | 2025-12-05    | 2     |\n| 6  | 1        | Emma D.    | 2025-12-06    | 2     |\n| 7  | 1        | Emma D.    | 2025-12-07    | 3     |\n| 8  | 1        | Emma D.    | 2025-12-08    | 5     |\n| 9  | 1        | Emma D.    | 2025-12-09    | 4     |\n| 10 | 1        | Emma D.    | 2025-12-10    | 5     |\n| 11 | 1        | Emma D.    | 2025-12-11    | 5     |\n| 12 | 1        | Emma D.    | 2025-12-12    | -1    |\n| 13 | 1        | Emma D.    | 2025-12-13    | 1     |\n| 14 | 1        | Emma D.    | 2025-12-14    | 1     |\n| 15 | 1        | Emma D.    | 2025-12-15    | -1    |\n| 16 | 1        | Emma D.    | 2025-12-16    | 3     |\n| 17 | 1        | Emma D.    | 2025-12-17    | -2    |\n| 18 | 1        | Emma D.    | 2025-12-18    | 1     |\n| 19 | 1        | Emma D.    | 2025-12-19    | 1     |\n| 20 | 1        | Emma D.    | 2025-12-20    | -2    |\n\u002b----\u002b----------\u002b------------\u002b---------------\u002b-------\u002b\nsqlite\u0026gt; SELECT * FROM behavior_logs WHERE child_name LIKE \u0026#39;Ava\u0026#39;;\nsqlite\u0026gt; SELECT * FROM behavior_logs WHERE child_name LIKE \u0026#39;Ava%\u0026#39;;\n\u002b------\u002b----------\u002b------------\u002b---------------\u002b-------\u002b\n|  id  | child_id | child_name | behavior_date | score |\n\u002b------\u002b----------\u002b------------\u002b---------------\u002b-------\u002b\n| 21   | 2        | Ava X.     | 2025-12-01    | 0     |\n| 22   | 2        | Ava X.     | 2025-12-02    | -1    |\n| 23   | 2        | Ava X.     | 2025-12-03    | 4     |\n| 24   | 2        | Ava X.     | 2025-12-04    | 0     |\n| 25   | 2        | Ava X.     | 2025-12-05    | 2     |\n| 26   | 2        | Ava X.     | 2025-12-06    | 3     |\n| 27   | 2        | Ava X.     | 2025-12-07    | 5     |\n| 28   | 2        | Ava X.     | 2025-12-08    | 2     |\n| 29   | 2        | Ava X.     | 2025-12-09    | 1     |\n| 30   | 2        | Ava X.     | 2025-12-10    | 5     |\n| 31   | 2        | Ava X.     | 2025-12-11    | 2     |\n| 32   | 2        | Ava X.     | 2025-12-12    | 5     |\n| 33   | 2        | Ava X.     | 2025-12-13    | 5     |\n| 34   | 2        | Ava X.     | 2025-12-14    | 2     |\n| 35   | 2        | Ava X.     | 2025-12-15    | 0     |\n| 36   | 2        | Ava X.     | 2025-12-16    | 0     |\n| 37   | 2        | Ava X.     | 2025-12-17    | 5     |\n| 38   | 2        | Ava X.     | 2025-12-18    | 4     |\n| 39   | 2        | Ava X.     | 2025-12-19    | 5     |\n| 40   | 2        | Ava X.     | 2025-12-20    | 5     |\n| 181  | 10       | Ava C.     | 2025-12-01    | 3     |\n| 182  | 10       | Ava C.     | 2025-12-02    | 0     |\n| 183  | 10       | Ava C.     | 2025-12-03    | 3     |\n| 184  | 10       | Ava C.     | 2025-12-04    | 5     |\n| 185  | 10       | Ava C.     | 2025-12-05    | 5     |\n| 186  | 10       | Ava C.     | 2025-12-06    | 4     |\n| 187  | 10       | Ava C.     | 2025-12-07    | 1     |\n| 188  | 10       | Ava C.     | 2025-12-08    | 4     |\n| 189  | 10       | Ava C.     | 2025-12-09    | 5     |\n| 190  | 10       | Ava C.     | 2025-12-10    | 5     |\n| 191  | 10       | Ava C.     | 2025-12-11    | 5     |\n| 192  | 10       | Ava C.     | 2025-12-12    | 0     |\n| 193  | 10       | Ava C.     | 2025-12-13    | 0     |\n| 194  | 10       | Ava C.     | 2025-12-14    | 3     |\n| 195  | 10       | Ava C.     | 2025-12-15    | 1     |\n| 196  | 10       | Ava C.     | 2025-12-16    | 3     |\n| 197  | 10       | Ava C.     | 2025-12-17    | -1    |\n| 198  | 10       | Ava C.     | 2025-12-18    | 0     |\n| 199  | 10       | Ava C.     | 2025-12-19    | 5     |\n| 200  | 10       | Ava C.     | 2025-12-20    | 4     |\n| 241  | 13       | Ava R.     | 2025-12-01    | 3     |\n| 242  | 13       | Ava R.     | 2025-12-02    | 2     |\n| 243  | 13       | Ava R.     | 2025-12-03    | 2     |\n| 244  | 13       | Ava R.     | 2025-12-04    | 1     |\n| 245  | 13       | Ava R.     | 2025-12-05    | -1    |\n| 246  | 13       | Ava R.     | 2025-12-06    | -1    |\n| 247  | 13       | Ava R.     | 2025-12-07    | 2     |\n| 248  | 13       | Ava R.     | 2025-12-08    | 5     |\n| 249  | 13       | Ava R.     | 2025-12-09    | 0     |\n| 250  | 13       | Ava R.     | 2025-12-10    | 5     |\n| 251  | 13       | Ava R.     | 2025-12-11    | 2     |\n| 252  | 13       | Ava R.     | 2025-12-12    | -1    |\n| 253  | 13       | Ava R.     | 2025-12-13    | 2     |\n| 254  | 13       | Ava R.     | 2025-12-14    | 3     |\n| 255  | 13       | Ava R.     | 2025-12-15    | 2     |\n| 256  | 13       | Ava R.     | 2025-12-16    | -1    |\n| 257  | 13       | Ava R.     | 2025-12-17    | -2    |\n| 258  | 13       | Ava R.     | 2025-12-18    | -4    |\n| 259  | 13       | Ava R.     | 2025-12-19    | -3    |\n| 260  | 13       | Ava R.     | 2025-12-20    | 2     |\n| 1961 | 99       | Ava X.     | 2025-12-01    | 2     |\n| 1962 | 99       | Ava X.     | 2025-12-02    | -2    |\n| 1963 | 99       | Ava X.     | 2025-12-03    | -1    |\n| 1964 | 99       | Ava X.     | 2025-12-04    | -2    |\n| 1965 | 99       | Ava X.     | 2025-12-05    | 3     |\n| 1966 | 99       | Ava X.     | 2025-12-06    | -1    |\n| 1967 | 99       | Ava X.     | 2025-12-07    | 0     |\n| 1968 | 99       | Ava X.     | 2025-12-08    | 1     |\n| 1969 | 99       | Ava X.     | 2025-12-09    | 0     |\n| 1970 | 99       | Ava X.     | 2025-12-10    | 0     |\n| 1971 | 99       | Ava X.     | 2025-12-11    | 3     |\n| 1972 | 99       | Ava X.     | 2025-12-12    | 4     |\n| 1973 | 99       | Ava X.     | 2025-12-13    | 4     |\n| 1974 | 99       | Ava X.     | 2025-12-14    | 0     |\n| 1975 | 99       | Ava X.     | 2025-12-15    | 3     |\n| 1976 | 99       | Ava X.     | 2025-12-16    | -1    |\n| 1977 | 99       | Ava X.     | 2025-12-17    | -1    |\n| 1978 | 99       | Ava X.     | 2025-12-18    | 3     |\n| 1979 | 99       | Ava X.     | 2025-12-19    | 3     |\n| 1980 | 99       | Ava X.     | 2025-12-20    | -3    |\n\u002b------\u002b----------\u002b------------\u002b---------------\u002b-------\u002b\nsqlite\u0026gt; \n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;Let\u0026#39;s get to the problem of day 11\u0026lt;\/p\u0026gt;\n\u0026lt;h2 id=\u0026#34;problem\u0026#34;\u0026gt;Problem\u0026lt;\/h2\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;Calculate the 7-day rolling average behavior score for each child. Identify any child whose rolling average drops below 0. For those children with a rolling average below 0, return the \u0026lt;code\u0026gt;child_id\u0026lt;\/code\u0026gt;, \u0026lt;code\u0026gt;child_name\u0026lt;\/code\u0026gt;, \u0026lt;code\u0026gt;behavior_date\u0026lt;\/code\u0026gt; (this will be the latest date in the 7-day rolling average), and the calculated 7-day rolling average. Only include results with a \u0026lt;code\u0026gt;behavior_date\u0026lt;\/code\u0026gt; of \u0026lt;code\u0026gt;December 7, 2025\u0026lt;\/code\u0026gt; or later, ensuring that each rolling average is based on a full 7 days of data.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;Order the results by \u0026lt;code\u0026gt;behavior_date\u0026lt;\/code\u0026gt; and then \u0026lt;code\u0026gt;child_name\u0026lt;\/code\u0026gt;.\u0026lt;\/p\u0026gt;\n\u0026lt;\/blockquote\u0026gt;\n\u0026lt;p\u0026gt;So, we need to do what?\u0026lt;\/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Group by child_id\u0026lt;\/li\u0026gt;\n\u0026lt;li\u0026gt;Compute the rolling average for the past 7 days (so if there is a data for 20 days from 1st to 20th December, we\u0026#39;ll only consider the average from 14th to 20th December)\u0026lt;\/li\u0026gt;\n\u0026lt;li\u0026gt;Order by behavior_date and child_name.\u0026lt;\/li\u0026gt;\n\u0026lt;\/ul\u0026gt;\n\u0026lt;h3 id=\u0026#34;using-simple-join\u0026#34;\u0026gt;Using Simple Join\u0026lt;\/h3\u0026gt;\n\u0026lt;p\u0026gt;We have to first grab the rolling average which is only for the past 7 days per child.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;So, to do that, we can self join the \u0026lt;code\u0026gt;behavior_log\u0026lt;\/code\u0026gt; table on the condition that the behavior date (from right table) is between the current behavior date (from left table) and 6 days past that for each child.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt;SELECT \n    behavior_logs.child_id,\n    behavior_logs.child_name,\n    behavior_logs.behavior_date,\n    AVG(week_logs.score) AS rolling_avg\nFROM \n    behavior_logs\nJOIN \n    behavior_logs week_logs\n    ON behavior_logs.child_id = week_logs.child_id\n    AND week_logs.behavior_date BETWEEN DATE(behavior_logs.behavior_date, \u0026#39;-6 days\u0026#39;) AND behavior_logs.behavior_date\nGROUP BY \n    behavior_logs.child_id;\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;We basically joined the table \u0026lt;code\u0026gt;behavior_logs\u0026lt;\/code\u0026gt; with itself, i.e. the right and left tables are the same. So, we join on the condition of same child_id, and then look for dates between the past 6 days and the current behavior date (we included the 7th day in the behavior date, so hence subtracting 6 days from that date).\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;We group by \u0026lt;code\u0026gt;child_id\u0026lt;\/code\u0026gt;, so that we get a single row for each \u0026lt;code\u0026gt;child_id\u0026lt;\/code\u0026gt;. We compute the \u0026lt;code\u0026gt;AVG(score)\u0026lt;\/code\u0026gt; to get the average score for each day in the range of the past 7 days.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;You see the issue, we need to compute the average for each week, and not just the last, it will give us the last most score for a child. We need to also group by the behavior date so as to keep week unique and have multiple entries for a child.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt;SELECT \n    behavior_logs.child_id,\n    behavior_logs.child_name,\n    behavior_logs.behavior_date,\n    AVG(week_logs.score) AS rolling_avg\nFROM \n    behavior_logs\nJOIN \n    behavior_logs week_logs\n    ON behavior_logs.child_id = week_logs.child_id\n    AND week_logs.behavior_date BETWEEN DATE(behavior_logs.behavior_date, \u0026#39;-6 days\u0026#39;) AND behavior_logs.behavior_date\nGROUP BY \n    behavior_logs.child_id, behavior_logs.behavior_date;\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;Now, we have grouped by \u0026lt;code\u0026gt;behavior_date\u0026lt;\/code\u0026gt; so that each child can have multiple entries for the weeks that we have logs for. Now we can further filter it.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;We also need to filter when the \u0026lt;code\u0026gt;rolling_average\u0026lt;\/code\u0026gt; is less than 0, that is the child had a bad week overall. So that will be in a \u0026lt;code\u0026gt;HAVING\u0026lt;\/code\u0026gt; condition and not a \u0026lt;code\u0026gt;WHERE\u0026lt;\/code\u0026gt; condition since \u0026lt;code\u0026gt;AVG\u0026lt;\/code\u0026gt; is a aggregate function, we can\u0026#39;t reference the \u0026lt;code\u0026gt;rolling_average\u0026lt;\/code\u0026gt; in the where clause, it won\u0026#39;t be defined there yet. So, we use \u0026lt;code\u0026gt;HAVING\u0026lt;\/code\u0026gt; to filter \u0026lt;code\u0026gt;rolling_average\u0026lt;\/code\u0026gt; as less than \u0026lt;code\u0026gt;0\u0026lt;\/code\u0026gt;.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt;SELECT \n    behavior_logs.child_id,\n    behavior_logs.child_name,\n    behavior_logs.behavior_date,\n    AVG(week_logs.score) AS rolling_avg\nFROM \n    behavior_logs\nJOIN \n    behavior_logs week_logs\n    ON behavior_logs.child_id = week_logs.child_id\n    AND week_logs.behavior_date BETWEEN DATE(behavior_logs.behavior_date, \u0026#39;-6 days\u0026#39;) AND behavior_logs.behavior_date\nGROUP BY \n    behavior_logs.child_id, behavior_logs.behavior_date\nHAVING \n    rolling_avg \u0026lt; 0;\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;We are now down to the rows that only have \u0026lt;code\u0026gt;bad\u0026lt;\/code\u0026gt; weeks for the child in various weeks.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;There is one catch however, we can\u0026#39;t use week periods before \u0026lt;code\u0026gt;7th December\u0026lt;\/code\u0026gt; because we don\u0026#39;t have enough data to compute the rolling average for the 7 day score. Hence we only include the records having logs after \u0026lt;code\u0026gt;7th December\u0026lt;\/code\u0026gt;.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;This again would come in the \u0026lt;code\u0026gt;HAVING\u0026lt;\/code\u0026gt; clause as we are deciding the final behavior date from the week and not the individual logs from the table.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt;SELECT \n    behavior_logs.child_id,\n    behavior_logs.child_name,\n    behavior_logs.behavior_date,\n    AVG(week_logs.score) AS rolling_avg\nFROM \n    behavior_logs\nJOIN \n    behavior_logs week_logs\n    ON behavior_logs.child_id = week_logs.child_id\n    AND week_logs.behavior_date BETWEEN DATE(behavior_logs.behavior_date, \u0026#39;-6 days\u0026#39;) AND behavior_logs.behavior_date\nGROUP BY \n    behavior_logs.child_id, behavior_logs.behavior_date\nHAVING \n    rolling_avg \u0026lt; 0\n    AND behavior_logs.behavior_date \u0026gt;= \u0026#39;2025-12-07\u0026#39;\n\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;Now, the final piece is the order.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;We need to order it by the \u0026lt;code\u0026gt;behavior_date\u0026lt;\/code\u0026gt; and the \u0026lt;code\u0026gt;child_name\u0026lt;\/code\u0026gt; as requested.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt;SELECT \n    behavior_logs.child_id,\n    behavior_logs.child_name,\n    behavior_logs.behavior_date,\n    AVG(week_logs.score) AS rolling_avg\nFROM \n    behavior_logs\nJOIN \n    behavior_logs week_logs\n    ON behavior_logs.child_id = week_logs.child_id\n    AND week_logs.behavior_date BETWEEN DATE(behavior_logs.behavior_date, \u0026#39;-6 days\u0026#39;) AND behavior_logs.behavior_date\nGROUP BY \n    behavior_logs.child_id, behavior_logs.behavior_date\nHAVING \n    rolling_avg \u0026lt; 0\n    AND behavior_logs.behavior_date \u0026gt;= \u0026#39;2025-12-07\u0026#39;\nORDER BY \n    behavior_logs.behavior_date, behavior_logs.child_name;\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;This is a simple solution.\nEasy to understand, and explain, not quite short and crisp.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;We can even do this in a sub query without a JOIN like so\u0026lt;\/p\u0026gt;\n\u0026lt;h3 id=\u0026#34;using-sub-query\u0026#34;\u0026gt;Using Sub-query\u0026lt;\/h3\u0026gt;\n\u0026lt;p\u0026gt;We take the conditions from the \u0026lt;code\u0026gt;JOIN\u0026lt;\/code\u0026gt; and replace that in a sub-query like so.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt;SELECT\n    current_logs.child_id,\n    current_logs.child_name,\n    current_logs.behavior_date,\n    (\n        SELECT AVG(past_logs.score)\n        FROM behavior_logs past_logs\n        WHERE past_logs.child_id = current_logs.child_id\n          AND past_logs.behavior_date\n              BETWEEN date(current_logs.behavior_date, \u0026#39;-6 days\u0026#39;)\n                  AND current_logs.behavior_date\n    ) AS rolling_avg\nFROM behavior_logs current_logs\nWHERE current_logs.behavior_date \u0026gt;= \u0026#39;2025-12-07\u0026#39;\n  AND rolling_avg \u0026lt; 0\nORDER BY current_logs.behavior_date, current_logs.child_name;\n\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;Since its a subquery, we don\u0026#39;t need to group by or add a having clause to filter the rolling average and the behavior date.\u0026lt;\/p\u0026gt;\n\u0026lt;h3 id=\u0026#34;using-sub-query-and-window-function\u0026#34;\u0026gt;Using Sub-query and Window Function\u0026lt;\/h3\u0026gt;\n\u0026lt;p\u0026gt;We can take the above query and instead of join, we can write a sub-query to compute the rolling average using window function.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt;SELECT\n    child_id,\n    child_name,\n    behavior_date,\n    AVG(score) OVER (\n        PARTITION BY child_id\n        ORDER BY behavior_date\n        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n    ) AS rolling_avg\nFROM behavior_logs\n\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;We use the \u0026lt;code\u0026gt;AVG(score) OVER ()\u0026lt;\/code\u0026gt; this is a partition. We partition or create a window for each child and we order by the behavior date and then create a sliding window for the past 7 days.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;The \u0026lt;code\u0026gt;ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\u0026lt;\/code\u0026gt; defines a 7-row sliding window for each child. Every row gets its own window, and each window is separate per child because of PARTITION BY \u0026lt;code\u0026gt;child_id\u0026lt;\/code\u0026gt;.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;So we get a full per day rolling average for each child with this query.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;This had around 2400 rows.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;Now, we need filter it down to the only rows where the rolling average is less than \u0026lt;code\u0026gt;0\u0026lt;\/code\u0026gt; and we don\u0026#39;t include the average for days before the \u0026lt;code\u0026gt;7th December\u0026lt;\/code\u0026gt; as we don\u0026#39;t have enough days before that to compute the 7-day rolling average.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;But this is a query in itself we can\u0026#39;t reference the \u0026lt;code\u0026gt;rolling_average\u0026lt;\/code\u0026gt; in the where clause as its not available there. We haven\u0026#39;t grouped by anything explicitly so we can\u0026#39;t use \u0026lt;code\u0026gt;HAVING\u0026lt;\/code\u0026gt;, we need to wrap it in a sub query to get the rolling average as well as the behavior date condition.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt;SELECT\n    child_id,\n    child_name,\n    behavior_date,\n    rolling_avg\nFROM (\n    SELECT\n        child_id,\n        child_name,\n        behavior_date,\n        AVG(score) OVER (\n            PARTITION BY child_id\n            ORDER BY behavior_date\n            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n        ) AS rolling_avg\n    FROM behavior_logs\n)\nWHERE behavior_date \u0026gt;= \u0026#39;2025-12-07\u0026#39;\n  AND rolling_avg \u0026lt; 0;\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;This will filter down the rows.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;Now, we also need to order by the \u0026lt;code\u0026gt;behavior_date\u0026lt;\/code\u0026gt; and then \u0026lt;code\u0026gt;child_name\u0026lt;\/code\u0026gt;.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt;SELECT\n    child_id,\n    child_name,\n    behavior_date,\n    rolling_avg\nFROM (\n    SELECT\n        child_id,\n        child_name,\n        behavior_date,\n        AVG(score) OVER (\n            PARTITION BY child_id\n            ORDER BY behavior_date\n            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n        ) AS rolling_avg\n    FROM behavior_logs\n)\nWHERE behavior_date \u0026gt;= \u0026#39;2025-12-07\u0026#39;\n  AND rolling_avg \u0026lt; 0\nORDER BY behavior_date, child_name;\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;So, that is again the same stuff just with window function.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;We can even do this with that subquery wrapped in a CTE (it just looks and reads good, nothing different really, other than you can use the CTE in the same query multiple times, here we don\u0026#39;t need to do it)\u0026lt;\/p\u0026gt;\n\u0026lt;h3 id=\u0026#34;using-cte-and-window-function\u0026#34;\u0026gt;Using CTE and Window Function\u0026lt;\/h3\u0026gt;\n\u0026lt;p\u0026gt;We just take the above sub-query and wrap it in a CTE.\u0026lt;\/p\u0026gt;\n\u0026lt;div class=\u0026#34;sql-playground\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;controls\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;run-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-play\u0026#34;\u0026gt;\u0026lt;polygon points=\u0026#34;5 3 19 12 5 21 5 3\u0026#34;\u0026gt;\u0026lt;\/polygon\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;edit-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-edit\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;path d=\u0026#34;M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;button class=\u0026#34;reset-button\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http:\/\/www.w3.org\/2000\/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;feather feather-refresh-cw\u0026#34;\u0026gt;\u0026lt;polyline points=\u0026#34;23 4 23 10 17 10\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;polyline points=\u0026#34;1 20 1 14 7 14\u0026#34;\u0026gt;\u0026lt;\/polyline\u0026gt;\u0026lt;path d=\u0026#34;M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36\u0026#34;\u0026gt;\u0026lt;\/path\u0026gt;\u0026lt;\/svg\u0026gt;\u0026lt;\/button\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;pre\u0026gt;\u0026lt;code class=\u0026#34;language-sql\u0026#34;\u0026gt;WITH rolling AS (\n    SELECT\n        child_id,\n        child_name,\n        behavior_date,\n        AVG(score) OVER (\n            PARTITION BY child_id\n            ORDER BY behavior_date\n            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n        ) AS rolling_avg\n    FROM behavior_logs\n)\nSELECT\n    child_id,\n    child_name,\n    behavior_date,\n    rolling_avg\nFROM rolling\nWHERE behavior_date \u0026gt;= \u0026#39;2025-12-07\u0026#39;\n  AND rolling_avg \u0026lt; 0\nORDER BY behavior_date, child_name;\n\n\u0026lt;\/code\u0026gt;\u0026lt;\/pre\u0026gt;\u0026lt;div class=\u0026#34;output\u0026#34;\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;\/div\u0026gt;\u0026lt;p\u0026gt;The rest remains the same, we just reference the \u0026lt;code\u0026gt;rolling\u0026lt;\/code\u0026gt; as the CTE and grab the necessary details in the query using that CTE.\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;That should be it for the Day 11!\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;Some cool CTE, Window function and pratical use case for computing rolling averages, loved it!\u0026lt;\/p\u0026gt;\n\u0026lt;p\u0026gt;On to the day 12!\u0026lt;\/p\u0026gt;\n"
    }
    </script>
    
    
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/code-block.css">
    <link rel="stylesheet" href="/post-navigation.css">
    
    <link rel="icon" href="/tbicon.png" type="image/png">
    <link rel="apple-touch-icon" href="/tbicon.png">
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link id="syntax-theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.13.0/sql-wasm.js"></script>
    <link rel="stylesheet" href="/sql-playground.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/sql/sql.min.js"></script>
    <script src="/sql-playground.js"></script>
    
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const body = document.body;
        const stylesheet = document.getElementById("syntax-theme");
        const themeToggle = document.getElementById('theme-toggle');

        function setSyntaxTheme(theme) {
            if (theme === "secondary") {
                stylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css";
            } else {
                stylesheet.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css";
            }
        }

        
        document.querySelectorAll("pre code").forEach((block) => {
            hljs.highlightElement(block);
        });

        
        const currentTheme = localStorage.getItem("theme") || "default";
        if (currentTheme === "secondary") {
            body.classList.add("secondary-theme");
            if (themeToggle) themeToggle.checked = true;
        }
        setSyntaxTheme(currentTheme);

        
        if (themeToggle) {
            themeToggle.addEventListener('change', () => {
                const newTheme = themeToggle.checked ? 'secondary' : 'default';
                if (themeToggle.checked) {
                    body.classList.add('secondary-theme');
                } else {
                    body.classList.remove('secondary-theme');
                }
                localStorage.setItem('theme', newTheme);
                setSyntaxTheme(newTheme);
            });
        }
        
        
        const editBtn = document.getElementById('editor-edit');
        if (editBtn) {
            editBtn.addEventListener('click', async function () {
                const slug = "sqlog\/advent-of-sql-2025-day-11";
                const type = "sqlog";
                console.log("Editing post:", slug, type);
                const url = "https:\/\/devmeetgor.netlify.app/.netlify/functions/api?slug=" + slug + "&method=edit&type=" + type;
                
                try {
                    const res = await fetch(url);
                    if (!res.ok) throw new Error("Failed to fetch edit content");
                    const html = await res.text();
                    document.querySelector('.post-content').innerHTML = html;
                } catch (err) {
                    console.error(err);
                    alert("Error loading editor content");
                }
            });
        }
    });
    </script>
    
    
    <script src="/seasonal-effects.js" defer></script>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EET2ZX4QY1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-EET2ZX4QY1');
    </script>
</head>
<body>
    <header class="header">
  <a class="site-title" href="/" aria-label="Meet Gor - Home">Meet Gor</a>
  <nav>
    <ul>
      <li><a href="/" aria-label="Home">Home</a></li>
      <li><a href="/posts" aria-label="Posts">Posts</a></li>
      <li><a href="/all-content" aria-label="All Content">All Content</a></li>
      <li><a href="/about" aria-label="About">About</a></li>
      <li><a href="/contact" aria-label="Contact">Contact</a></li>
    </ul>
  </nav>
  <div class="theme-switch">
    <input type="checkbox" id="theme-toggle" aria-label="Toggle Theme">
    <label for="theme-toggle"></label>
  </div>
  
</header>
    
    <main class="container">
        <article class="blog-post">
            <h1>Advent of SQL 2025 Day 11: Behavior Score</h1>
            
            <div class="post-meta">
                Published on  <time datetime="2025-12-26 15:30 &#43;0530">2025-12-26 15:30 &#43;0530</time>
            </div>
            
            <div class="post-meta">
                Type: <a href="/sqlog">sqlog</a>
            </div>
            
            <div class="post-meta tags">
                <span class="post-series-label"> Tags:</span>
                
                <a href="/tags/sqlite">#sqlite</a>
                
                <a href="/tags/sql">#sql</a>
                
                <a href="/tags/advent-of-sql">#advent-of-sql</a>
                
            </div>
            
            
            <div class="post-series">
                <span class="series-label">Part of the
                <span class="series-list">
                    
                    <a href="/series/advent-of-sql-2025" class="series-link"> advent-of-sql-2025</a>
                    
                </span></span>
                <span class="series-label">series</span>
            </div>
            
            
            
            
            <hr>
            
            <div class="post-content">
                <h2 id="advent-of-sql---day-11-behavior-score">Advent of SQL - Day 11, Behavior Score</h2>
<p>All right, this is day 11 from Advent of SQL.</p>
<p>Let's pull in the data.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql">DROP TABLE IF EXISTS behavior_logs;

CREATE TABLE behavior_logs (
    id INT PRIMARY KEY,
    child_id INT,
    child_name TEXT,
    behavior_date DATE,
    score INT
);

INSERT INTO behavior_logs (id, child_id, child_name, behavior_date, score) VALUES
    (1, 1, 'Emma D.', '2025-12-01', 5),
    (2, 1, 'Emma D.', '2025-12-02', 1),
    (3, 1, 'Emma D.', '2025-12-03', 3),
    (4, 1, 'Emma D.', '2025-12-04', 5),
    (5, 1, 'Emma D.', '2025-12-05', 2),
    (6, 1, 'Emma D.', '2025-12-06', 2),
    (7, 1, 'Emma D.', '2025-12-07', 3),
    (8, 1, 'Emma D.', '2025-12-08', 5),
    (9, 1, 'Emma D.', '2025-12-09', 4),
    (10, 1, 'Emma D.', '2025-12-10', 5),
    (11, 1, 'Emma D.', '2025-12-11', 5),
    (12, 1, 'Emma D.', '2025-12-12', -1),
    (13, 1, 'Emma D.', '2025-12-13', 1),
    (14, 1, 'Emma D.', '2025-12-14', 1),
    (15, 1, 'Emma D.', '2025-12-15', -1),
    (16, 1, 'Emma D.', '2025-12-16', 3),
    (17, 1, 'Emma D.', '2025-12-17', -2),
    (18, 1, 'Emma D.', '2025-12-18', 1),
    (19, 1, 'Emma D.', '2025-12-19', 1),
    (20, 1, 'Emma D.', '2025-12-20', -2),
    (21, 2, 'Ava X.', '2025-12-01', 0),
    (22, 2, 'Ava X.', '2025-12-02', -1),
    (23, 2, 'Ava X.', '2025-12-03', 4),
    (24, 2, 'Ava X.', '2025-12-04', 0),
    (25, 2, 'Ava X.', '2025-12-05', 2),
    (26, 2, 'Ava X.', '2025-12-06', 3),
    (27, 2, 'Ava X.', '2025-12-07', 5),
    (28, 2, 'Ava X.', '2025-12-08', 2),
    (29, 2, 'Ava X.', '2025-12-09', 1),
    (30, 2, 'Ava X.', '2025-12-10', 5),
    (31, 2, 'Ava X.', '2025-12-11', 2),
    (32, 2, 'Ava X.', '2025-12-12', 5),
    (33, 2, 'Ava X.', '2025-12-13', 5),
    (34, 2, 'Ava X.', '2025-12-14', 2),
    (35, 2, 'Ava X.', '2025-12-15', 0),
    (36, 2, 'Ava X.', '2025-12-16', 0),
    (37, 2, 'Ava X.', '2025-12-17', 5),
    (38, 2, 'Ava X.', '2025-12-18', 4),
    (39, 2, 'Ava X.', '2025-12-19', 5),
    (40, 2, 'Ava X.', '2025-12-20', 5),
    (181, 10, 'Ava C.', '2025-12-01', 3),
    (182, 10, 'Ava C.', '2025-12-02', 0),
    (183, 10, 'Ava C.', '2025-12-03', 3),
    (184, 10, 'Ava C.', '2025-12-04', 5),
    (185, 10, 'Ava C.', '2025-12-05', 5),
    (186, 10, 'Ava C.', '2025-12-06', 4),
    (187, 10, 'Ava C.', '2025-12-07', 1),
    (188, 10, 'Ava C.', '2025-12-08', 4),
    (189, 10, 'Ava C.', '2025-12-09', 5),
    (190, 10, 'Ava C.', '2025-12-10', 5),
    (191, 10, 'Ava C.', '2025-12-11', 5),
    (192, 10, 'Ava C.', '2025-12-12', 0),
    (193, 10, 'Ava C.', '2025-12-13', 0),
    (194, 10, 'Ava C.', '2025-12-14', 3),
    (195, 10, 'Ava C.', '2025-12-15', 1),
    (196, 10, 'Ava C.', '2025-12-16', 3),
    (197, 10, 'Ava C.', '2025-12-17', -1),
    (198, 10, 'Ava C.', '2025-12-18', 0),
    (199, 10, 'Ava C.', '2025-12-19', 5),
    (200, 10, 'Ava C.', '2025-12-20', 4),
    (241, 13, 'Ava R.', '2025-12-01', 3),
    (242, 13, 'Ava R.', '2025-12-02', 2),
    (243, 13, 'Ava R.', '2025-12-03', 2),
    (244, 13, 'Ava R.', '2025-12-04', 1),
    (245, 13, 'Ava R.', '2025-12-05', -1),
    (246, 13, 'Ava R.', '2025-12-06', -1),
    (247, 13, 'Ava R.', '2025-12-07', 2),
    (248, 13, 'Ava R.', '2025-12-08', 5),
    (249, 13, 'Ava R.', '2025-12-09', 0),
    (250, 13, 'Ava R.', '2025-12-10', 5),
    (251, 13, 'Ava R.', '2025-12-11', 2),
    (252, 13, 'Ava R.', '2025-12-12', -1),
    (253, 13, 'Ava R.', '2025-12-13', 2),
    (254, 13, 'Ava R.', '2025-12-14', 3),
    (255, 13, 'Ava R.', '2025-12-15', 2),
    (256, 13, 'Ava R.', '2025-12-16', -1),
    (257, 13, 'Ava R.', '2025-12-17', -2),
    (258, 13, 'Ava R.', '2025-12-18', -4),
    (259, 13, 'Ava R.', '2025-12-19', -3),
    (260, 13, 'Ava R.', '2025-12-20', 2),
    (1961, 99, 'Ava X.', '2025-12-01', 2),
    (1962, 99, 'Ava X.', '2025-12-02', -2),
    (1963, 99, 'Ava X.', '2025-12-03', -1),
    (1964, 99, 'Ava X.', '2025-12-04', -2),
    (1965, 99, 'Ava X.', '2025-12-05', 3),
    (1966, 99, 'Ava X.', '2025-12-06', -1),
    (1967, 99, 'Ava X.', '2025-12-07', 0),
    (1968, 99, 'Ava X.', '2025-12-08', 1),
    (1969, 99, 'Ava X.', '2025-12-09', 0),
    (1970, 99, 'Ava X.', '2025-12-10', 0),
    (1971, 99, 'Ava X.', '2025-12-11', 3),
    (1972, 99, 'Ava X.', '2025-12-12', 4),
    (1973, 99, 'Ava X.', '2025-12-13', 4),
    (1974, 99, 'Ava X.', '2025-12-14', 0),
    (1975, 99, 'Ava X.', '2025-12-15', 3),
    (1976, 99, 'Ava X.', '2025-12-16', -1),
    (1977, 99, 'Ava X.', '2025-12-17', -1),
    (1978, 99, 'Ava X.', '2025-12-18', 3),
    (1979, 99, 'Ava X.', '2025-12-19', 3),
    (1980, 99, 'Ava X.', '2025-12-20', -3);
</code></pre><div class="output"></div></div><p>No hiccups! Good to go.</p>
<p>We just have one table today.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql"> SELECT * FROM behavior_logs;
</code></pre><div class="output"></div></div><div class="code-block"><div class="code-header"><span class="language-name"></span><button class="copy-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div><pre><code>sqlite> .read day11-inserts.sql
sqlite> .mode table
sqlite> .schema
CREATE TABLE behavior_logs (
    id INT PRIMARY KEY,
    child_id INT,
    child_name TEXT,
    behavior_date DATE,
    score INT
);
sqlite> SELECT * FROM behavior_logs LIMIT 20;
+----+----------+------------+---------------+-------+
| id | child_id | child_name | behavior_date | score |
+----+----------+------------+---------------+-------+
| 1  | 1        | Emma D.    | 2025-12-01    | 5     |
| 2  | 1        | Emma D.    | 2025-12-02    | 1     |
| 3  | 1        | Emma D.    | 2025-12-03    | 3     |
| 4  | 1        | Emma D.    | 2025-12-04    | 5     |
| 5  | 1        | Emma D.    | 2025-12-05    | 2     |
| 6  | 1        | Emma D.    | 2025-12-06    | 2     |
| 7  | 1        | Emma D.    | 2025-12-07    | 3     |
| 8  | 1        | Emma D.    | 2025-12-08    | 5     |
| 9  | 1        | Emma D.    | 2025-12-09    | 4     |
| 10 | 1        | Emma D.    | 2025-12-10    | 5     |
| 11 | 1        | Emma D.    | 2025-12-11    | 5     |
| 12 | 1        | Emma D.    | 2025-12-12    | -1    |
| 13 | 1        | Emma D.    | 2025-12-13    | 1     |
| 14 | 1        | Emma D.    | 2025-12-14    | 1     |
| 15 | 1        | Emma D.    | 2025-12-15    | -1    |
| 16 | 1        | Emma D.    | 2025-12-16    | 3     |
| 17 | 1        | Emma D.    | 2025-12-17    | -2    |
| 18 | 1        | Emma D.    | 2025-12-18    | 1     |
| 19 | 1        | Emma D.    | 2025-12-19    | 1     |
| 20 | 1        | Emma D.    | 2025-12-20    | -2    |
+----+----------+------------+---------------+-------+
sqlite> SELECT * FROM behavior_logs WHERE child_name LIKE 'Ava';
sqlite> SELECT * FROM behavior_logs WHERE child_name LIKE 'Ava%';
+------+----------+------------+---------------+-------+
|  id  | child_id | child_name | behavior_date | score |
+------+----------+------------+---------------+-------+
| 21   | 2        | Ava X.     | 2025-12-01    | 0     |
| 22   | 2        | Ava X.     | 2025-12-02    | -1    |
| 23   | 2        | Ava X.     | 2025-12-03    | 4     |
| 24   | 2        | Ava X.     | 2025-12-04    | 0     |
| 25   | 2        | Ava X.     | 2025-12-05    | 2     |
| 26   | 2        | Ava X.     | 2025-12-06    | 3     |
| 27   | 2        | Ava X.     | 2025-12-07    | 5     |
| 28   | 2        | Ava X.     | 2025-12-08    | 2     |
| 29   | 2        | Ava X.     | 2025-12-09    | 1     |
| 30   | 2        | Ava X.     | 2025-12-10    | 5     |
| 31   | 2        | Ava X.     | 2025-12-11    | 2     |
| 32   | 2        | Ava X.     | 2025-12-12    | 5     |
| 33   | 2        | Ava X.     | 2025-12-13    | 5     |
| 34   | 2        | Ava X.     | 2025-12-14    | 2     |
| 35   | 2        | Ava X.     | 2025-12-15    | 0     |
| 36   | 2        | Ava X.     | 2025-12-16    | 0     |
| 37   | 2        | Ava X.     | 2025-12-17    | 5     |
| 38   | 2        | Ava X.     | 2025-12-18    | 4     |
| 39   | 2        | Ava X.     | 2025-12-19    | 5     |
| 40   | 2        | Ava X.     | 2025-12-20    | 5     |
| 181  | 10       | Ava C.     | 2025-12-01    | 3     |
| 182  | 10       | Ava C.     | 2025-12-02    | 0     |
| 183  | 10       | Ava C.     | 2025-12-03    | 3     |
| 184  | 10       | Ava C.     | 2025-12-04    | 5     |
| 185  | 10       | Ava C.     | 2025-12-05    | 5     |
| 186  | 10       | Ava C.     | 2025-12-06    | 4     |
| 187  | 10       | Ava C.     | 2025-12-07    | 1     |
| 188  | 10       | Ava C.     | 2025-12-08    | 4     |
| 189  | 10       | Ava C.     | 2025-12-09    | 5     |
| 190  | 10       | Ava C.     | 2025-12-10    | 5     |
| 191  | 10       | Ava C.     | 2025-12-11    | 5     |
| 192  | 10       | Ava C.     | 2025-12-12    | 0     |
| 193  | 10       | Ava C.     | 2025-12-13    | 0     |
| 194  | 10       | Ava C.     | 2025-12-14    | 3     |
| 195  | 10       | Ava C.     | 2025-12-15    | 1     |
| 196  | 10       | Ava C.     | 2025-12-16    | 3     |
| 197  | 10       | Ava C.     | 2025-12-17    | -1    |
| 198  | 10       | Ava C.     | 2025-12-18    | 0     |
| 199  | 10       | Ava C.     | 2025-12-19    | 5     |
| 200  | 10       | Ava C.     | 2025-12-20    | 4     |
| 241  | 13       | Ava R.     | 2025-12-01    | 3     |
| 242  | 13       | Ava R.     | 2025-12-02    | 2     |
| 243  | 13       | Ava R.     | 2025-12-03    | 2     |
| 244  | 13       | Ava R.     | 2025-12-04    | 1     |
| 245  | 13       | Ava R.     | 2025-12-05    | -1    |
| 246  | 13       | Ava R.     | 2025-12-06    | -1    |
| 247  | 13       | Ava R.     | 2025-12-07    | 2     |
| 248  | 13       | Ava R.     | 2025-12-08    | 5     |
| 249  | 13       | Ava R.     | 2025-12-09    | 0     |
| 250  | 13       | Ava R.     | 2025-12-10    | 5     |
| 251  | 13       | Ava R.     | 2025-12-11    | 2     |
| 252  | 13       | Ava R.     | 2025-12-12    | -1    |
| 253  | 13       | Ava R.     | 2025-12-13    | 2     |
| 254  | 13       | Ava R.     | 2025-12-14    | 3     |
| 255  | 13       | Ava R.     | 2025-12-15    | 2     |
| 256  | 13       | Ava R.     | 2025-12-16    | -1    |
| 257  | 13       | Ava R.     | 2025-12-17    | -2    |
| 258  | 13       | Ava R.     | 2025-12-18    | -4    |
| 259  | 13       | Ava R.     | 2025-12-19    | -3    |
| 260  | 13       | Ava R.     | 2025-12-20    | 2     |
| 1961 | 99       | Ava X.     | 2025-12-01    | 2     |
| 1962 | 99       | Ava X.     | 2025-12-02    | -2    |
| 1963 | 99       | Ava X.     | 2025-12-03    | -1    |
| 1964 | 99       | Ava X.     | 2025-12-04    | -2    |
| 1965 | 99       | Ava X.     | 2025-12-05    | 3     |
| 1966 | 99       | Ava X.     | 2025-12-06    | -1    |
| 1967 | 99       | Ava X.     | 2025-12-07    | 0     |
| 1968 | 99       | Ava X.     | 2025-12-08    | 1     |
| 1969 | 99       | Ava X.     | 2025-12-09    | 0     |
| 1970 | 99       | Ava X.     | 2025-12-10    | 0     |
| 1971 | 99       | Ava X.     | 2025-12-11    | 3     |
| 1972 | 99       | Ava X.     | 2025-12-12    | 4     |
| 1973 | 99       | Ava X.     | 2025-12-13    | 4     |
| 1974 | 99       | Ava X.     | 2025-12-14    | 0     |
| 1975 | 99       | Ava X.     | 2025-12-15    | 3     |
| 1976 | 99       | Ava X.     | 2025-12-16    | -1    |
| 1977 | 99       | Ava X.     | 2025-12-17    | -1    |
| 1978 | 99       | Ava X.     | 2025-12-18    | 3     |
| 1979 | 99       | Ava X.     | 2025-12-19    | 3     |
| 1980 | 99       | Ava X.     | 2025-12-20    | -3    |
+------+----------+------------+---------------+-------+
sqlite> 
</code></pre></div><p>Let's get to the problem of day 11</p>
<h2 id="problem">Problem</h2>
<blockquote>
<p>Calculate the 7-day rolling average behavior score for each child. Identify any child whose rolling average drops below 0. For those children with a rolling average below 0, return the <code>child_id</code>, <code>child_name</code>, <code>behavior_date</code> (this will be the latest date in the 7-day rolling average), and the calculated 7-day rolling average. Only include results with a <code>behavior_date</code> of <code>December 7, 2025</code> or later, ensuring that each rolling average is based on a full 7 days of data.</p>
<p>Order the results by <code>behavior_date</code> and then <code>child_name</code>.</p>
</blockquote>
<p>So, we need to do what?</p>
<ul>
<li>Group by child_id</li>
<li>Compute the rolling average for the past 7 days (so if there is a data for 20 days from 1st to 20th December, we'll only consider the average from 14th to 20th December)</li>
<li>Order by behavior_date and child_name.</li>
</ul>
<h3 id="using-simple-join">Using Simple Join</h3>
<p>We have to first grab the rolling average which is only for the past 7 days per child.</p>
<p>So, to do that, we can self join the <code>behavior_log</code> table on the condition that the behavior date (from right table) is between the current behavior date (from left table) and 6 days past that for each child.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql">SELECT 
    behavior_logs.child_id,
    behavior_logs.child_name,
    behavior_logs.behavior_date,
    AVG(week_logs.score) AS rolling_avg
FROM 
    behavior_logs
JOIN 
    behavior_logs week_logs
    ON behavior_logs.child_id = week_logs.child_id
    AND week_logs.behavior_date BETWEEN DATE(behavior_logs.behavior_date, '-6 days') AND behavior_logs.behavior_date
GROUP BY 
    behavior_logs.child_id;
</code></pre><div class="output"></div></div><p>We basically joined the table <code>behavior_logs</code> with itself, i.e. the right and left tables are the same. So, we join on the condition of same child_id, and then look for dates between the past 6 days and the current behavior date (we included the 7th day in the behavior date, so hence subtracting 6 days from that date).</p>
<p>We group by <code>child_id</code>, so that we get a single row for each <code>child_id</code>. We compute the <code>AVG(score)</code> to get the average score for each day in the range of the past 7 days.</p>
<p>You see the issue, we need to compute the average for each week, and not just the last, it will give us the last most score for a child. We need to also group by the behavior date so as to keep week unique and have multiple entries for a child.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql">SELECT 
    behavior_logs.child_id,
    behavior_logs.child_name,
    behavior_logs.behavior_date,
    AVG(week_logs.score) AS rolling_avg
FROM 
    behavior_logs
JOIN 
    behavior_logs week_logs
    ON behavior_logs.child_id = week_logs.child_id
    AND week_logs.behavior_date BETWEEN DATE(behavior_logs.behavior_date, '-6 days') AND behavior_logs.behavior_date
GROUP BY 
    behavior_logs.child_id, behavior_logs.behavior_date;
</code></pre><div class="output"></div></div><p>Now, we have grouped by <code>behavior_date</code> so that each child can have multiple entries for the weeks that we have logs for. Now we can further filter it.</p>
<p>We also need to filter when the <code>rolling_average</code> is less than 0, that is the child had a bad week overall. So that will be in a <code>HAVING</code> condition and not a <code>WHERE</code> condition since <code>AVG</code> is a aggregate function, we can't reference the <code>rolling_average</code> in the where clause, it won't be defined there yet. So, we use <code>HAVING</code> to filter <code>rolling_average</code> as less than <code>0</code>.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql">SELECT 
    behavior_logs.child_id,
    behavior_logs.child_name,
    behavior_logs.behavior_date,
    AVG(week_logs.score) AS rolling_avg
FROM 
    behavior_logs
JOIN 
    behavior_logs week_logs
    ON behavior_logs.child_id = week_logs.child_id
    AND week_logs.behavior_date BETWEEN DATE(behavior_logs.behavior_date, '-6 days') AND behavior_logs.behavior_date
GROUP BY 
    behavior_logs.child_id, behavior_logs.behavior_date
HAVING 
    rolling_avg < 0;
</code></pre><div class="output"></div></div><p>We are now down to the rows that only have <code>bad</code> weeks for the child in various weeks.</p>
<p>There is one catch however, we can't use week periods before <code>7th December</code> because we don't have enough data to compute the rolling average for the 7 day score. Hence we only include the records having logs after <code>7th December</code>.</p>
<p>This again would come in the <code>HAVING</code> clause as we are deciding the final behavior date from the week and not the individual logs from the table.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql">SELECT 
    behavior_logs.child_id,
    behavior_logs.child_name,
    behavior_logs.behavior_date,
    AVG(week_logs.score) AS rolling_avg
FROM 
    behavior_logs
JOIN 
    behavior_logs week_logs
    ON behavior_logs.child_id = week_logs.child_id
    AND week_logs.behavior_date BETWEEN DATE(behavior_logs.behavior_date, '-6 days') AND behavior_logs.behavior_date
GROUP BY 
    behavior_logs.child_id, behavior_logs.behavior_date
HAVING 
    rolling_avg < 0
    AND behavior_logs.behavior_date >= '2025-12-07'

</code></pre><div class="output"></div></div><p>Now, the final piece is the order.</p>
<p>We need to order it by the <code>behavior_date</code> and the <code>child_name</code> as requested.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql">SELECT 
    behavior_logs.child_id,
    behavior_logs.child_name,
    behavior_logs.behavior_date,
    AVG(week_logs.score) AS rolling_avg
FROM 
    behavior_logs
JOIN 
    behavior_logs week_logs
    ON behavior_logs.child_id = week_logs.child_id
    AND week_logs.behavior_date BETWEEN DATE(behavior_logs.behavior_date, '-6 days') AND behavior_logs.behavior_date
GROUP BY 
    behavior_logs.child_id, behavior_logs.behavior_date
HAVING 
    rolling_avg < 0
    AND behavior_logs.behavior_date >= '2025-12-07'
ORDER BY 
    behavior_logs.behavior_date, behavior_logs.child_name;
</code></pre><div class="output"></div></div><p>This is a simple solution.
Easy to understand, and explain, not quite short and crisp.</p>
<p>We can even do this in a sub query without a JOIN like so</p>
<h3 id="using-sub-query">Using Sub-query</h3>
<p>We take the conditions from the <code>JOIN</code> and replace that in a sub-query like so.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql">SELECT
    current_logs.child_id,
    current_logs.child_name,
    current_logs.behavior_date,
    (
        SELECT AVG(past_logs.score)
        FROM behavior_logs past_logs
        WHERE past_logs.child_id = current_logs.child_id
          AND past_logs.behavior_date
              BETWEEN date(current_logs.behavior_date, '-6 days')
                  AND current_logs.behavior_date
    ) AS rolling_avg
FROM behavior_logs current_logs
WHERE current_logs.behavior_date >= '2025-12-07'
  AND rolling_avg < 0
ORDER BY current_logs.behavior_date, current_logs.child_name;

</code></pre><div class="output"></div></div><p>Since its a subquery, we don't need to group by or add a having clause to filter the rolling average and the behavior date.</p>
<h3 id="using-sub-query-and-window-function">Using Sub-query and Window Function</h3>
<p>We can take the above query and instead of join, we can write a sub-query to compute the rolling average using window function.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql">SELECT
    child_id,
    child_name,
    behavior_date,
    AVG(score) OVER (
        PARTITION BY child_id
        ORDER BY behavior_date
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_avg
FROM behavior_logs

</code></pre><div class="output"></div></div><p>We use the <code>AVG(score) OVER ()</code> this is a partition. We partition or create a window for each child and we order by the behavior date and then create a sliding window for the past 7 days.</p>
<p>The <code>ROWS BETWEEN 6 PRECEDING AND CURRENT ROW</code> defines a 7-row sliding window for each child. Every row gets its own window, and each window is separate per child because of PARTITION BY <code>child_id</code>.</p>
<p>So we get a full per day rolling average for each child with this query.</p>
<p>This had around 2400 rows.</p>
<p>Now, we need filter it down to the only rows where the rolling average is less than <code>0</code> and we don't include the average for days before the <code>7th December</code> as we don't have enough days before that to compute the 7-day rolling average.</p>
<p>But this is a query in itself we can't reference the <code>rolling_average</code> in the where clause as its not available there. We haven't grouped by anything explicitly so we can't use <code>HAVING</code>, we need to wrap it in a sub query to get the rolling average as well as the behavior date condition.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql">SELECT
    child_id,
    child_name,
    behavior_date,
    rolling_avg
FROM (
    SELECT
        child_id,
        child_name,
        behavior_date,
        AVG(score) OVER (
            PARTITION BY child_id
            ORDER BY behavior_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS rolling_avg
    FROM behavior_logs
)
WHERE behavior_date >= '2025-12-07'
  AND rolling_avg < 0;
</code></pre><div class="output"></div></div><p>This will filter down the rows.</p>
<p>Now, we also need to order by the <code>behavior_date</code> and then <code>child_name</code>.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql">SELECT
    child_id,
    child_name,
    behavior_date,
    rolling_avg
FROM (
    SELECT
        child_id,
        child_name,
        behavior_date,
        AVG(score) OVER (
            PARTITION BY child_id
            ORDER BY behavior_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS rolling_avg
    FROM behavior_logs
)
WHERE behavior_date >= '2025-12-07'
  AND rolling_avg < 0
ORDER BY behavior_date, child_name;
</code></pre><div class="output"></div></div><p>So, that is again the same stuff just with window function.</p>
<p>We can even do this with that subquery wrapped in a CTE (it just looks and reads good, nothing different really, other than you can use the CTE in the same query multiple times, here we don't need to do it)</p>
<h3 id="using-cte-and-window-function">Using CTE and Window Function</h3>
<p>We just take the above sub-query and wrap it in a CTE.</p>
<div class="sql-playground"><div class="controls"><button class="run-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><button class="edit-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button class="reset-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64M3.51 15A9 9 0 0 0 18.36 18.36"></path></svg></button></div><pre><code class="language-sql">WITH rolling AS (
    SELECT
        child_id,
        child_name,
        behavior_date,
        AVG(score) OVER (
            PARTITION BY child_id
            ORDER BY behavior_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS rolling_avg
    FROM behavior_logs
)
SELECT
    child_id,
    child_name,
    behavior_date,
    rolling_avg
FROM rolling
WHERE behavior_date >= '2025-12-07'
  AND rolling_avg < 0
ORDER BY behavior_date, child_name;

</code></pre><div class="output"></div></div><p>The rest remains the same, we just reference the <code>rolling</code> as the CTE and grab the necessary details in the query using that CTE.</p>
<p>That should be it for the Day 11!</p>
<p>Some cool CTE, Window function and pratical use case for computing rolling averages, loved it!</p>
<p>On to the day 12!</p>

            </div>
        </article>
        
        
        

<nav class="post-navigation" aria-label="Post Navigation">
    <div class="nav-container">
        
        
        <a href="/sqlog/advent-of-sql-2025-day-10" class="nav-link nav-prev" title="Previous Post">
            <span class="nav-arrow"></span>
            <span class="nav-label">Previous</span>
            <span class="nav-title">Advent of SQL 2025 Day 10: Misdelivered Presents</span>
        </a>
        

        
        
        <a href="/sqlog/advent-of-sql-2025-day-12" class="nav-link nav-next" title="Next Post">
            <span class="nav-label">Next</span>
            <span class="nav-title">Advent of SQL 2025 Day 12: Archive Flight Records</span>
            <span class="nav-arrow"></span>
        </a>
        
    </div>
</nav>


        
        
        


<aside class="related-reading" aria-labelledby="related-reading-title">
    <h3 id="related-reading-title" class="related-title"> Related Reading</h3>
    <ul class="related-list">
        
        
        <li class="related-item">
            <a href="/sqlog/advent-of-sql-2025-day-15" class="related-link">
                <span class="related-post-title">Advent of SQL 2025 Day 15: Confirmation Phrase Dispatches</span>
                <span class="related-post-date">2025-12-28 20:30 &#43;0530</span>
            </a>
        </li>
        
        
        
        <li class="related-item">
            <a href="/sqlog/advent-of-sql-2025-day-14" class="related-link">
                <span class="related-post-title">Advent of SQL 2025 Day 14: Ski Resort Paths</span>
                <span class="related-post-date">2025-12-28 15:30 &#43;0530</span>
            </a>
        </li>
        
        
        
        <li class="related-item">
            <a href="/sqlog/advent-of-sql-2025-day-13" class="related-link">
                <span class="related-post-title">Advent of SQL 2025 Day 13: XML Travel Manifests</span>
                <span class="related-post-date">2025-12-27 20:30 &#43;0530</span>
            </a>
        </li>
        
        
        
        <li class="related-item">
            <a href="/sqlog/advent-of-sql-2025-day-12" class="related-link">
                <span class="related-post-title">Advent of SQL 2025 Day 12: Archive Flight Records</span>
                <span class="related-post-date">2025-12-27 15:30 &#43;0530</span>
            </a>
        </li>
        
        
        
        <li class="related-item">
            <a href="/sqlog/advent-of-sql-2025-day-10" class="related-link">
                <span class="related-post-title">Advent of SQL 2025 Day 10: Misdelivered Presents</span>
                <span class="related-post-date">2025-12-25 15:30 &#43;0530</span>
            </a>
        </li>
        
        
    </ul>
</aside>


    </main>
    
    <div id="comments">
        <script src="https://giscus.app/client.js"
            data-repo="Mr-Destructive/meetgor.com"
            data-repo-id="R_kgDOHZ6V_g"
            data-category="Q&A"
            data-category-id="DIC_kwDOHZ6V_s4CRfn4"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="dark_high_contrast"
            data-lang="en"
            crossorigin="anonymous"
            async>
        </script>
    </div>
    
    <footer class="site-footer" role="contentinfo">
  <div class="footer-content">
    <p>&copy; Meet Gor. All rights reserved.</p>
    <div class="social-links">
      <a href="/contact" aria-label="Connect with me">Connect with me</a>
    </div>
  </div>
</footer>
    
</body>
</html>
